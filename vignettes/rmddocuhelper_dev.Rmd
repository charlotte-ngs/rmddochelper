---
title: "rmddocuhelper Package Development"
author: "Peter von Rohr"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
---

```{r DocumentSetup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = 'asis')
```

```{r DocumentStatus, eval=TRUE}
r6obj_docstat <- rmddochelper::R6ClassDocuStatus$new()
r6obj_docstat$setProject(psProject = "rmddochelper")
#r6obj_docstat$setVersion(psVersion = "0.0.901")
#r6obj_docstat$setStatus(psStatus = "Initialisation")
# r6obj_docstat$setVersion(psVersion = "0.0.902")
# r6obj_docstat$setStatus(psStatus = "Extended Introduction")
# r6obj_docstat$setVersion(psVersion = "0.0.903")
# r6obj_docstat$setStatus(psStatus = "Describe replacement function")
r6obj_docstat$setVersion(psVersion = "0.0.904")
r6obj_docstat$setStatus(psStatus = "Description of document status")

r6obj_docstat$include_doc_stat()
```


## Disclaimer
This document is a collection of ideas, plans and specifications that are important for developing the package `rmddocuhelper`.


## Introduction
Creating documents is easy using tools like `Rstudio`, `rmarkdown`, `knitr` and `pandoc`. The source of such a document is written in a special version of markdown called `rmarkdown`. In addition to ordinary markdown, `rmarkdown` allows for direct inclusion of `R`-statements in the document markup source. The `knitr` package is used to convert the rmarkdown sources into ordinary markdown source file. During that conversion all `R`-statements are evaluated and evaluation results are collected and included into the markdown document. The transformation of `rmarkdown` sources to markdown by `knitr` is analogous to what `Sweave` does with `LaTeX` source files. The advantage of using `knitr` and `rmarkdown` is that we have to use considerably less markup instructions compared to `Sweave` and `LaTeX`. On the other hand, if we really need the expressive power of `LaTeX`, we can include chunks of `LaTeX` statements which are automatically converted by the latter used conversion tool called `pandoc`. The document conversion tool `pandoc` converts the produced markdown document into many different output formats, such as HTML or PDF. Although, pandoc is a very powerful conversion tool, there are limits when trying to convert `LaTeX` sources into output formats such as `docx`. One example of such a restriction is when graphics are included in markdown files using the `LaTeX` statement `\includegraphics`, those diagrams will not show up in a `docx`-formatted document that is produced by pandoc. In that case one has to stick to the markdown syntax for including graphics.  


## Objective
The above mentioned tool chain consisting of `Rstudio`, `rmarkdown`, `knitr` and `pandoc` is great for starting documents via the GUI provided by `Rstudio`. Whenever the number of documents to be created increases above a certain level and the structure of the created documents is very similar, a more scalable and more flexible approach for document creation is needed. 

Scalability and flexibility can be increased by replacing the GUI by a function-based UI when creating new documents and by the very heavy usage of templates. That means, we provide simple functions that create documents based on templates. The document creation functions can be called with parameters that are used to replace placeholders in the templates.

### Template based document creation
As an example, we  assume the following template

```{r DocumentTemplate, echo=TRUE}
docu_template <- "---
title: [REPLACE_WITH_TITLE]
author: [REPLACE_WITH_AUTHOR]
date: [REPLACE_WITH_DATE]
output: rmarkdown::html_vignette
---
## [REPLACE_WITH_SECTION]" 
```

We want to replace all the `[REPLACE_WITH_*]` tags with information specific for the document to be created. The replacement information will be provided in a list (`repl_info`) that has names that match the end of the tags.

```{r ReplacementInfo, echo=TRUE}
repl_info <- list(title   = "My First Document",
                  author  = "Peter von Rohr",
                  date    = format(Sys.Date(), "%Y-%m-%d"),
                  section = "First Section")

#' Convert a tag to a replacement placeholder
#'
#' @param    psTag   tag to be converted to a placeholder
#' @return   replacement placeholder
get_repl_tag <- function(psTag){
  return(paste0("[REPLACE_WITH_", toupper(psTag), "]"))
}

#' Replacement of placeholder by replacement list values
#'
#' @param    ps_docu_template   document template string
#' @param    pl_repl_info       replacement info list
#' @return   s_docu_result      document result string
gsub_templ_pattern <- function(ps_docu_template, pl_repl_info){
  s_docu_result <- ps_docu_template
  for (sTag in names(pl_repl_info)){
    s_docu_result <- gsub(get_repl_tag(psTag = sTag), 
                          pl_repl_info[[sTag]], 
                          s_docu_result, 
                          fixed = TRUE)
  }
  return(s_docu_result)
}
```

The replacement of the placeholders is done in function `gsub_templ_pattern()`. In that function, we loop over the names of the replacement list and replace occurrences of the placeholders with the associated replacement list values. The names in the replacement list are converted to placeholders using the helper-function `get_repl_tag()`. The result after the replacement is shown below.

```{r OutputAfterReplacement}
### # output result of replacement
cat("```\n", gsub_templ_pattern(ps_docu_template = docu_template, pl_repl_info = repl_info), "\n```\n")
```

# Document status
The status of a document is shown in a separate section that contains one table. That table contains information about the version of the document, the date, the author, the status and the project to which this document is associated to. This information is important mostly for internal use. Whenever a document is published or sent to external institutions, that information should most likely be hidden in the final output. Hence a useful feature is the possibility to easily be able to hide the whole section on the document status.

In this package `rmddocuhelper`, the document status is implemented in a R6 class called `R6ClassDocuStatus`. This class has fields to store the version, the data, the author, the status and the project. Apart from the getter and setter methods of the fields, there is only one public method that produces the table containing the document status. The resulting output of this method is shown at the beginning of this document.


# Abreviation list
